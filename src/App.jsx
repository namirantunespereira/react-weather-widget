import { useEffect, useState } from "react";import "./styles.css";const API_KEY = import.meta.env.VITE_OPENWEATHER_API_KEY;const I18N = { en: { title:"Weather Widget", help:"Search by city or use your location.", searchPlaceholder:"Search city (e.g. London)", search:"Search", useGeo:"Use my location", loading:"Loading...", feels:(v)=>`feels like ${v}°C`, humidity:"Humidity", wind:"Wind", footer:"Data from OpenWeatherMap · Built by Namir Antunes" }, pt: { title:"Widget de Clima", help:"Busque por cidade ou use sua localização.", searchPlaceholder:"Buscar cidade (ex.: São Paulo)", search:"Buscar", useGeo:"Usar minha localização", loading:"Carregando...", feels:(v)=>`sensação térmica ${v}°C`, humidity:"Umidade", wind:"Vento", footer:"Dados da OpenWeatherMap · Construído por Namir Antunes" } };export default function App(){ const [lang,setLang] = useState(new URLSearchParams(location.search).get('lang')||'en'); const dict = I18N[lang]; const [query,setQuery] = useState('London'); const [weather,setWeather] = useState(null); const [loading,setLoading] = useState(false); const [err,setErr] = useState(''); async function fetchByCity(city){ setLoading(true); setErr(''); setWeather(null); try{ const url = `https://api.openweathermap.org/data/2.5/weather?q=${encodeURIComponent(city)}&appid=${API_KEY}&units=metric`; const res = await fetch(url); if(!res.ok) throw new Error(`Request failed (${res.status})`); const json = await res.json(); setWeather(json); } catch(e){ setErr(e.message||'Something went wrong'); } finally{ setLoading(false); } } async function fetchByCoords(lat,lon){ setLoading(true); setErr(''); setWeather(null); try{ const url = `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${API_KEY}&units=metric`; const res = await fetch(url); if(!res.ok) throw new Error(`Request failed (${res.status})`); const json = await res.json(); setWeather(json); } catch(e){ setErr(e.message||'Something went wrong'); } finally{ setLoading(false); } } useEffect(()=>{ fetchByCity(query); },[]); function handleSubmit(e){ e.preventDefault(); if(!query.trim()) return; fetchByCity(query.trim()); } function handleGeo(){ if(!navigator.geolocation){ setErr('Geolocation not supported'); return; } navigator.geolocation.getCurrentPosition((pos)=>{ const {latitude,longitude}=pos.coords; fetchByCoords(latitude,longitude); }, ()=> setErr('Could not read your location.')); } const temp = weather?.main?.temp?.toFixed?.(1); const feels = weather?.main?.feels_like?.toFixed?.(1); const icon = weather?.weather?.[0]?.icon; const desc = weather?.weather?.[0]?.description; const cityName = weather?.name; const country = weather?.sys?.country; const humidity = weather?.main?.humidity; const wind = weather?.wind?.speed; function setLanguage(next){ setLang(next); const u=new URL(location.href); u.searchParams.set('lang', next); history.replaceState({}, '', u.pathname+u.search); } return (<div className="wrap"><header className="header"><h1>{dict.title}</h1><p className="muted">{dict.help}</p><div className="tabs"><button className={`tab ${lang==='en'?'active':''}`} onClick={()=>setLanguage('en')}>EN</button><button className={`tab ${lang==='pt'?'active':''}`} onClick={()=>setLanguage('pt')}>PT</button></div></header><form className="row" onSubmit={handleSubmit}><input type="text" placeholder={dict.searchPlaceholder} value={query} onChange={(e)=>setQuery(e.target.value)} /><button className="btn" type="submit">{dict.search}</button><button className="btn secondary" type="button" onClick={handleGeo}>{dict.useGeo}</button></form>{loading && <div className="card glass"><p>{dict.loading}</p></div>}{err && <div className="card glass error"><p>{err}</p></div>}{weather && (<div className="card glass"><div className="hero"><div><h2>{cityName} {country ? <span className="muted">({country})</span> : null}</h2><p className="muted">{desc}</p><div className="temp"><span className="value">{temp}°C</span><span className="feels">{dict.feels(feels)}</span></div><ul className="meta"><li>{dict.humidity}: {humidity}%</li><li>{dict.wind}: {wind} m/s</li></ul></div><div className="icon">{icon && (<img src={`https://openweathermap.org/img/wn/${icon}@2x.png`} alt={desc||'weather icon'} />)}</div></div></div>)}<footer className="footer"><p className="muted">{dict.footer}</p></footer></div>); }